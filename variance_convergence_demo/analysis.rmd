---
output:
  pdf_document: default
---
```{r}
#install.packages("cumstats")
setwd("G:\\My Drive\\Research\\Contextual Bandits\\code\\bandits\\variance_convergence_demo")

library(cumstats)
library(ggplot2)
library(dplyr)

```


#Hypothesis
## Three scenarios
### 1. Same mean, different variance
### 2. Same variance, different mean (small variance)
### 3. Same variance, different mean (large variance)

### For scenario 1, we expect the error of variance estimate i.e (sigma - sugma_hat)
### to converge faster if variance value is less. For scenarios 2,3 it should not matter


## 1. Same mean, different variance

```{r, warning=FALSE}
x = c(1:100)
set.seed(123)
a = rnorm(100,0,1)
b = rnorm(100,0,4)
ca = cumvar(a)
cb = cumvar(b)
error_ca = 1-ca
error_cb = 16-cb
df = data.frame(x=x, error_ca = error_ca, error_cb=error_cb)
ggplot(df) + geom_line(aes(x,error_ca), color='blue') + geom_line(aes(x,error_cb), color='red') +
  ggtitle("Same mean, different variance") + ggsave("Same mean different variance.png")

```



## 1a. Same mean, different variance

```{r, warning=FALSE}

var_func <- function(vec, m){
  out = vector()
  for(i in 1:length(vec)){
    new_vec = vec[1:i]
    v = 0
    for(j in new_vec){
    v = v+(m-j)**2}
  out = c(out, v/length(new_vec))
    }
  return(out)
}


ca = var_func(a, 0)
cb = var_func(b, 0)


error_ca = 1-ca
error_cb = 16-cb
df = data.frame(x=x, error_ca = error_ca, error_cb=error_cb)
ggplot(df) + geom_line(aes(x,error_ca), color='blue') + geom_line(aes(x,error_cb), color='red') +
  ggtitle("Same mean, different variance") + ggsave("Same mean different variance1.png")

```



## 2. Same variance, different mean (small variance)

```{r, warning=FALSE}
set.seed(1234)
x = c(1:100)
a = rnorm(100,1,1)
b = rnorm(100,16,1)
ca = cummean(a)
cb = cummean(b)
error_ca = 1-ca
error_cb = 16-cb
df = data.frame(x=x, error_ca = error_ca, error_cb=error_cb)
ggplot(df) + geom_line(aes(x,error_ca), color='blue') + geom_line(aes(x,error_cb), color='red')+
  ggtitle("Same variance, different mean (small variance)") + ggsave("Same variance different mean (small variance).png")

```


## 3. Same variance, different mean (large variance)

```{r, warning=FALSE}


x = c(1:100)
a = rnorm(100,1,4)
b = rnorm(100,16,4)
ca = cummean(a)
cb = cummean(b)
error_ca = 1-ca
error_cb = 16-cb
df = data.frame(x=x, error_ca = error_ca, error_cb=error_cb)
ggplot(df) + geom_line(aes(x,error_ca), color='blue') + geom_line(aes(x,error_cb), color='red')+
  ggtitle("Same variance, different mean (large variance)") + ggsave("Same variance different mean (large variance).png")
```



# All hypothesis are proven
# In Graph 1 red and blue lines are clearly not following similar path even on different seeds.
# Graph 2 and 3 are following similar path for different seeds



```{r}
main_df = data.frame()
for (ite in 1:300) {
a =  rnorm(2,1,2)
b =  rnorm(2,1,3)
ca = c()
cb = c()
all = c()
for (i in 1:200) {
  m = var(a)
  n = var(b)
  if (m^2/(length(a)-1) >= n^2/(length(b)-1)){
    a = c(a, rnorm(1,1,1))
    ca = c(ca, var(a))
    cb = c(cb, var(b))
    all = c(all, 0)
  }
  else {
  b = c(b, rnorm(1,1,4))
  ca = c(ca, var(a))
    cb = c(cb, var(b))
    all = c(all, 1)
  }
  
}
x = c(1:200)
main_df = rbind(main_df, data.frame('x'=x, 'ca'=ca, 'cb'=cb, 'ite'=ite))
}

main_df = main_df %>% mutate(error_ca = 1-ca, error_cb = 16-cb) %>% group_by(x) %>% summarise(mean_error_ca = mean(error_ca), mean_error_cb = mean(error_cb), se_ca = sd(error_ca)/sqrt(n()), se_cb = sd(error_cb)/sqrt(n()))

ggplot(main_df) +
  geom_line(aes(x,mean_error_ca), color='blue')+
  geom_ribbon(aes(x,mean_error_ca,ymin=mean_error_ca+se_ca*qnorm(0.975), 
                  ymax=mean_error_ca-se_ca*qnorm(0.975)), alpha = 0.2, fill="grey70") +
  geom_line(aes(x,mean_error_cb), color='red')+
  geom_ribbon(aes(x,mean_error_cb,ymin=mean_error_cb+se_ca*qnorm(0.975), 
                  ymax=mean_error_cb-se_cb*qnorm(0.975)), alpha = 0.2, fill="grey70") 




```

